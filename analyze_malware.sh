#!/usr/bin/env bash


underline=$(tput smul)
nounderline=$(tput rmul)
red=$(tput setaf 1)
blue=$(tput setaf 6)
txtrst=$(tput sgr0)

if [ -z "$1" ]; then
  echo "Usage: analyze_file <malware file>"
  exit
fi

file_type=$(file $1 | awk '{first = $1; $1 = ""; print $0}' | sed 's/^.//g')
file_size_bytes=$(stat $1 | grep "Size" | sed 's/^..//g' | awk '{print $2}')
file_size_kilobytes=$(python3 division.py $file_size_bytes 1024)
file_size_megabytes=$(python3 division.py $file_size_kilobytes 1024)
file_size_gigabytes=$(python3 division.py $file_size_megabytes 1024)
length_of_file_name=$(basename $1 | wc -c)
new_length_of_file=$(expr $length_of_file_name - 1)
hash_sum=$(md5sum $1 | awk '{print $1}')
first_two_bytes=$(head -c 2 $1 && printf "\n")
permissions=$(stat $1 | grep "Access" | awk '{print $2}' | sed '$d;s/(//;s/)//')

printf_new() {
 str=$1
 num=$2
 v=$(printf "%-${num}s" "$str")
 echo "${v// /*}+"
}

printf "+" && printf_new "*" "$new_length_of_file"
echo "|$blue$(basename $1)$txtrst|"
printf "+" && printf_new "*" "$new_length_of_file"
printf "\n"
echo "File type: $underline$file_type$nounderline$txtrst"
printf "\n"
printf "Size: $underline$file_size_bytes$txtrst (bytes)\n"
printf "           └──$underline$file_size_kilobytes$txtrst (kilobytes)\n"
printf "              └──$underline$file_size_megabytes$txtrst (megabytes)\n"
printf "                 └──$underline$file_size_gigabytes$txtrst (gigabytes)\n"
printf "\n"
echo "Hash Sum: $underline$hash_sum$txtrst"
printf "\n"
echo "First two bytes: $underline$first_two_bytes$txtrst"
if [[ "$first_two_bytes" == "MZ" ]]; then
  echo "└──Is a PE Binary"
fi
printf "\n"
echo "Permissions: $underline$permissions$txtrst"
printf "\n"
if [[ "$2" == "-s" ]]; then
  echo "[+] Searching google for $underline$hash_sum$txtrst..."
  echo "q" | googler "$hash_sum"
  printf "\n"
fi
